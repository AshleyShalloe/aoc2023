<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../res/main.css">
    <script type="text/javascript" src="../res/main.js"></script>
    <title>Advent of Code // Day 11</title>
    <link rel="icon" href="../favicon.png" />
</head>

<body>

    <h2>Universe go stretchy</h2>
    <input id="fancyAnswer1" disabled></input>
    <h2>Advent of Code Cinematic Universe</h2>
    <input id="fancyAnswer2" disabled></input>

</body>
<script>
    'use strict'

    const testInput = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

    const puzzleInput = `......#.....#.........................#...........#..........#.....#.......#..............#.................................................
.....................#....................................................................................#........#........#.......#.......
.........................................................#............................#..................................................#..
.........................#.......#..............................#............................#.................#............................
..................#...................................................................................#.....................................
...........................................#....................................#.................................................#.........
...........................................................#..........#..........................#..........................................
............#...............#..............................................................#................................................
...#.................#.............................................................................................#........................
........#..........................#.................#....................#.................................................................
.................#............................#..................................#..................#...........................#...........
........................................#.................#............................#...................#...............................#
...............................#..................#..................................................................................#......
..............#.........#...................................................................................................................
......................................................#....................................#.....#....................#.....................
#..................#........#.............#......................#.................#.....................#.....................#............
............................................................................................................................................
........#....................................................................................................#......................#.....#.
................................#............#...............#...........#............#.....................................................
.................................................................................................................#..........................
................#..........................................................................#................................................
.....................#.................#..........#............................#.............................................#..............
......#................................................#....................................................................................
...................................#................................#..................#............#.........#........................#....
..........................................#.................................................................................................
............................................................................................#.........................#.....................
.............................#..............................................................................................................
#...............#......#.................................#..........................#.............................#.........................
.................................#.......................................................................#...................#..............
....#.....................................................................#....................#..........................................#.
............................................#.........#..........................#...............................................#..........
............................................................................................................................................
.........................#....................................#........................................#................#...................
.......#...........................#..................................................#.....#...............................................
.................................................................................................................#...................#......
.............#...............................................................#..................#...........................#...............
..................#.........................................................................................................................
.........#............................#........#.........#.........#................................................#...................#...
............................................................................................................................................
......................#..................................................................................#.......................#..........
...........................................................................#........#............#..........................................
............#..............#.........................................#......................................................................
.....#............#.................................#......................................#...............................#...............#
............................................................................................................................................
#.........................................#.................................................................................................
........................#..........#...........#..............#...................................#.........................................
........................................................#..........................#.......................#....................#...........
...........................................................................#................................................................
..#....................................#...........................#...................#....................................................
.......#............................................#................................................................#......................
..............#............#...............................................................#..................#.............................
......................................................................#.........#....................................................#......
............................................................................................................................................
..........#..........#.........................#............#...........................#........#..........................................
...........................................................................#............................#....................#...........#..
.............................#..................................................................................#...........................
..........................................#.................................................................................................
.....#..........#................#..................................................#......#.............................#......#...........
............................................................................................................................................
.#.........#..............#..................#........#..........#.....................................#....................................
........................................#.....................................................#..........................................#..
..............................#...........................................#................................#.........#......................
............................................................................................................................................
............................................................................................................................................
......#...........................#.................#...........................#.......................#................#.............#....
..........................#.............................................#...................................................................
................................................................#...........................................................................
........................................#...............#.............................#.....#......................................#........
......................#...........................................................................#..............#..........................
..................................................#.........#......#...........................................................#........#...
..#..............#..........................#................................#.....#........................................................
............................................................................................................................................
....................................#.................................#........................#.......#......#..........#..................
.......#...............................................................................#...................................................#
...............#.......................................#........................................................................#...........
...........................................#................................................................................................
.......................#..............#............................................#................................................#.......
............................................................................................................................................
.#..........................#............................#..................................#..........#......#.............................
............................................................................................................................................
............................................................................................................................................
............#......#.....#.......................#...............................................#..........................................
..........................................................................................#..............#..................................
.....................................................................#............................................#.........................
................................................................................#.........................................#.................
....#..........#..................................................................................................................#.....#...
........................................................#...................................#......#........................................
........#...........#......#......................#.....................#............#......................................................
...................................#..............................#...........................................................#.............
.................................................................................................................#..........................
.........................................#............#....................#..................#......................................#......
........................#.....................#...........................................................................................#.
...................................................................................................#.....#..................................
............................................................................................................................................
.....................................#...................#...............................................................#.....#............
.....................#........................................#.......................#.....................................................
.............#............#.....#...........................................#......................................................#.......#
.......#...................................................................................#..............#.................................
#.......................................#.............................#.............................................#.......................
...................................#............................#..............................#......................................#.....
..............................................................................................................#.............#...............
........................................................................................#..........#........................................
...............#..........................#..............#..........#.......................................................................
......#..................................................................#.......................................#.................#........
................................................#...........................................................#.................#.............
#...................#........#...................................................................#..........................................
............................................#...................................#...........#.......................#.......................
........#...................................................................................................................................
.....................................#............#.........#......#................................................................#.......
.................#....................................................................#..............#......................................
................................................................................................#.........................#.................
...........................#..............#.................................................................................................
..........#.................................................................................................................................
................................................#.......#...........................#........#....................#................#........
.......................................#.........................#..................................#......#................................
..................................#.................#....................................#.................................#...............#
...........................................#................................................................................................
......#.....................................................................................................................................
......................#.......#......................................#......#...............................................................
................................................#......#...............................................................#................#...
..............#................................................................................#.............................#..............
..........................................#.............................#........................................#..........................
.........................#...........................................................................#..............................#.......
....................................#.......................................................................................................
....#...............#..............................................#....................#...........................#.......................
..........................................................#.................................................................................
..........................................................................#.......................#.........................................
..............#.............................................................................................#...................#.........#.
.......................#.....................#.......................#............................................#.........................
...............................#...................................................#........................................................
.................#......................................................................#............................................#......
.......#...................................................#................#........................#..................#...................
.#...........#..............#...............................................................................................................
.....................#............................#.................#............#..............#...........................................
...........................................#...........#.................#.................................#................................
...............................#......................................................#....................................................#
.............................................................................#..............................................................
.................................................................................................................................#..........
.......................#...........#..........#............#.....#........................#.............................................#...
.#..........#...............#......................................................#......................#......#..........................`

    function parseInput(input) {
        return input.split("\n").map(x => x.split(""))
    }

    function getIdxOfEmptyRows() {
        return (
            parsedInput
                .map((x, i) => x.join("").replaceAll(".", "").length ? "filterMe" : i)
                .filter(x => x != "filterMe")
                .toSorted()
        )
    }

    function getIdxOfEmptyCols() {
        var width = parsedInput[0].length
        var idxArray = []

        for (var i = 0; i < width; i++) {
            var colData = parsedInput.map(x => x[i])
            var isColBlank = !colData.join("").replaceAll(".", "").length

            if (isColBlank) {
                idxArray.push(i)
            }
        }
        return idxArray.toSorted()
    }

    function expandTheUniverse() {
        var emptyRowIdxArray = getIdxOfEmptyRows()
        var emptyColIdxArray = getIdxOfEmptyCols()
        var rowsInserted = 0
        var colsInserted = 0
        var returnArray = [...parsedInput]
        var startWidth = parsedInput[0].length
        var startHeight = parseInput.length

        for (var i = 0; i < emptyRowIdxArray.length; i++) {
            var emptyRowIdx = emptyRowIdxArray[i]
            returnArray.splice(emptyRowIdx + rowsInserted, 0, Array(startWidth).fill("."))
            rowsInserted++
        }

        for (var i = 0; i < emptyColIdxArray.length; i++) {
            var emptyColIdx = emptyColIdxArray[i]
            returnArray = returnArray.map(x =>
                x.toSpliced(emptyColIdx + colsInserted, 0, ".")
            )
            colsInserted++
        }

        return returnArray
    }

    function getAllGalaxyCoords(inputUniverse) {
        var returnArray = []

        for (var i = 0; i < inputUniverse.length; i++) {
            for (var j = 0; j < inputUniverse[i].length; j++) {
                var coords = [j, i] // equiv to col,row (i.e. x,y)
                if (inputUniverse[i][j] == "#") {
                    returnArray.push(coords)
                }
            }
        }
        return returnArray
    }

    function getAllGalaxyCoordPairs(inputUniverse) {
        var coords = getAllGalaxyCoords(inputUniverse)
        var pairs = new Set()
        for (var i = 0; i < coords.length; i++) {
            for (var j = 0; j < coords.length; j++) {
                var tempPair = JSON.stringify([coords[i], coords[j]])
                var pairTemp = JSON.stringify([coords[j], coords[i]])
                if (i == j) {
                    continue
                }
                if (pairs.has(tempPair) || pairs.has(pairTemp)) {
                    continue
                }
                else {
                    pairs.add(tempPair)
                }
            }
        }
        return [...pairs].map(x => JSON.parse(x))
    }

    function taxicabDistance(coords0, coords1) {
        var x0 = coords0[0]
        var x1 = coords1[0]
        var y0 = coords0[1]
        var y1 = coords1[1]

        return Math.abs(x1 - x0) + Math.abs(y1 - y0)
    }

    function getAdventOfCodeCinematicUniverse() {
        var emptyColIdxArray = getIdxOfEmptyCols()
        var emptyRowIdxArray = getIdxOfEmptyRows()
        var coordPairArray = getAllGalaxyCoordPairs(parsedInput)
        var expandedCoordPairArray = []
        var expansionFactor = 1000000

        for (var i = 0; i < coordPairArray.length; i++) {
            var coordPair = coordPairArray[i]
            var x0 = coordPair[0][0]
            var x1 = coordPair[1][0]
            var y0 = coordPair[0][1]
            var y1 = coordPair[1][1]
            var sortedXCoords = [x0, x1].sort((a, b) => a - b)
            var sortedYCoords = [y0, y1].sort((a, b) => a - b)

            var emptyColsPassed = emptyColIdxArray.filter(x =>
                (x > sortedXCoords[0])
                && (x < sortedXCoords[1])
            ).length

            var emptyRowsPassed = emptyRowIdxArray.filter(x =>
                (x > sortedYCoords[0])
                && (x < sortedYCoords[1])
            ).length

            var finalX0 = sortedXCoords[0]
            var finalX1 = sortedXCoords[1] + ((expansionFactor - 1) * emptyColsPassed)
            var finalY0 = sortedYCoords[0]
            var finalY1 = sortedYCoords[1] + ((expansionFactor - 1) * emptyRowsPassed)

            expandedCoordPairArray.push([[finalX0, finalY0], [finalX1, finalY1]])
        }

        return (
            expandedCoordPairArray
                .map(x => taxicabDistance(x[0], x[1]))
                .reduce((a, b) => a + b, 0)
        )
    }


    function solvePuzzle() {
        return (
            getAllGalaxyCoordPairs(expandTheUniverse(parsedInput))
                .map(x => taxicabDistance(x[0], x[1]))
                .reduce((a, b) => a + b, 0)
        )
    }


    function solvePuzzlePt2() {
        return getAdventOfCodeCinematicUniverse()
    }

    function init() {
        document.getElementById("fancyAnswer1").value = solvePuzzle()
        document.getElementById("fancyAnswer2").value = solvePuzzlePt2()
    }

    // globals
    const testing = false
    const parsedInput = parseInput(testing ? testInput : puzzleInput)

    // init
    init();
</script>

</html>